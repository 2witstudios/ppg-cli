<Window x:Class="PPGDesktop.Views.SpawnDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Spawn Agent" Height="500" Width="480"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="{StaticResource ChromeBackgroundBrush}"
        ShowInTaskbar="False">

    <Grid Margin="24,20">
        <!-- Phase 1: Variant Selection -->
        <StackPanel Visibility="{Binding ShowPromptPhase, Converter={StaticResource BoolToVisibility},
                                         ConverterParameter=invert}">
            <TextBlock Text="Select Agent Type" FontSize="18" FontWeight="Bold"
                       Foreground="{StaticResource ForegroundBrush}" Margin="0,0,0,16" />

            <ItemsControl ItemsSource="{Binding Variants}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border x:Name="VariantCard" Background="{StaticResource CardBackgroundBrush}"
                                CornerRadius="8" Padding="16,12" Margin="0,0,0,8"
                                Cursor="Hand"
                                MouseLeftButtonUp="VariantCard_Click">
                            <StackPanel>
                                <TextBlock Text="{Binding DisplayName}" FontSize="14" FontWeight="SemiBold"
                                           Foreground="{StaticResource ForegroundBrush}" />
                                <TextBlock Text="{Binding Subtitle}" FontSize="12"
                                           Foreground="{StaticResource MutedForegroundBrush}"
                                           Margin="0,2,0,0" />
                            </StackPanel>
                        </Border>
                        <DataTemplate.Triggers>
                            <Trigger SourceName="VariantCard" Property="IsMouseOver" Value="True">
                                <Setter TargetName="VariantCard" Property="Background"
                                        Value="{StaticResource CardHeaderBrush}" />
                            </Trigger>
                        </DataTemplate.Triggers>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </StackPanel>

        <!-- Phase 2: Prompt Input -->
        <StackPanel Visibility="{Binding ShowPromptPhase, Converter={StaticResource BoolToVisibility}}">
            <DockPanel Margin="0,0,0,16">
                <Button DockPanel.Dock="Left" Content="&lt; Back"
                        Command="{Binding GoBackCommand}"
                        Background="Transparent" Foreground="{StaticResource AccentBrush}"
                        BorderThickness="0" FontSize="12" Cursor="Hand" />
                <TextBlock Text="{Binding SelectedVariant.DisplayName}" FontSize="18" FontWeight="Bold"
                           Foreground="{StaticResource ForegroundBrush}"
                           HorizontalAlignment="Center" />
            </DockPanel>

            <!-- Name -->
            <TextBlock Text="Worktree Name" FontSize="12"
                       Foreground="{StaticResource MutedForegroundBrush}" Margin="0,0,0,4" />
            <TextBox Text="{Binding WorktreeName, UpdateSourceTrigger=PropertyChanged}"
                     FontSize="13" Padding="8,6" Margin="0,0,0,12"
                     Background="{StaticResource CardBackgroundBrush}"
                     Foreground="{StaticResource ForegroundBrush}"
                     BorderBrush="{StaticResource BorderBrush}" />

            <!-- Prompt -->
            <TextBlock Text="Prompt (optional)" FontSize="12"
                       Foreground="{StaticResource MutedForegroundBrush}" Margin="0,0,0,4" />
            <TextBox Text="{Binding Prompt, UpdateSourceTrigger=PropertyChanged}"
                     FontSize="13" Padding="8,6" Height="120"
                     TextWrapping="Wrap" AcceptsReturn="True"
                     VerticalScrollBarVisibility="Auto"
                     Background="{StaticResource CardBackgroundBrush}"
                     Foreground="{StaticResource ForegroundBrush}"
                     BorderBrush="{StaticResource BorderBrush}" />

            <!-- Agent Count -->
            <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                <TextBlock Text="Agent Count:" FontSize="12"
                           Foreground="{StaticResource MutedForegroundBrush}"
                           VerticalAlignment="Center" Margin="0,0,8,0" />
                <TextBox Text="{Binding AgentCount, UpdateSourceTrigger=PropertyChanged}"
                         Width="50" FontSize="13" Padding="8,4"
                         Background="{StaticResource CardBackgroundBrush}"
                         Foreground="{StaticResource ForegroundBrush}"
                         BorderBrush="{StaticResource BorderBrush}"
                         HorizontalContentAlignment="Center" />
            </StackPanel>

            <!-- Error -->
            <TextBlock Text="{Binding ErrorMessage}" FontSize="12"
                       Foreground="#f87171" Margin="0,8,0,0"
                       Visibility="{Binding ErrorMessage, Converter={StaticResource BoolToVisibility}}" />

            <!-- Buttons -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
                <Button Content="Cancel" Command="{Binding CancelCommand}"
                        Padding="16,8" Margin="0,0,8,0"
                        Background="Transparent"
                        Foreground="{StaticResource MutedForegroundBrush}"
                        BorderBrush="{StaticResource BorderBrush}" />
                <Button Content="{Binding IsSpawning, Converter={StaticResource InverseBool},
                                          ConverterParameter=Spawn|Spawning...}"
                        Command="{Binding SpawnCommand}"
                        IsEnabled="{Binding IsSpawning, Converter={StaticResource InverseBool}}"
                        Padding="16,8"
                        Background="{StaticResource AccentBrush}"
                        Foreground="White"
                        BorderThickness="0" />
            </StackPanel>
        </StackPanel>
    </Grid>
</Window>
